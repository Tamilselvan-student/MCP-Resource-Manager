/**
 * List resources with optional category filter
 */
async function executeListResources(
    command: ParsedCommand,
    executorId: number
): Promise<CommandResult> {
    try {
        const categoryFilter = command.entities.category;

        let query = `
            SELECT 
                data->>'name' as name,
                data->>'category' as category,
                resource_type,
                created_at,
                created_by
            FROM resources
        `;

        const params: any[] = [];

        // Add category filter if specified
        if (categoryFilter) {
            query += ` WHERE LOWER(data->>'category') = LOWER($1)`;
            params.push(categoryFilter);
        }

        query += ` ORDER BY created_at DESC LIMIT 50`;

        const result = await pool.query(query, params);

        if (result.rowCount === 0) {
            const msg = categoryFilter 
                ? `üìÅ No resources found in **${categoryFilter}** category.`
                : 'üìÅ No resources found in the system.';
            
            return {
                success: true,
                message: msg
            };
        }

        // Group by category
        const byCategory: Record<string, any[]> = {};
        result.rows.forEach(row => {
            const cat = row.category || 'Uncategorized';
            if (!byCategory[cat]) byCategory[cat] = [];
            byCategory[cat].push(row);
        });

        // Format response
        let message = categoryFilter
            ? `üìÅ **Resources in ${categoryFilter}** (${result.rowCount} total)\n\n`
            : `üìÅ **All Resources** (${result.rowCount} total)\n\n`;

        for (const [category, resources] of Object.entries(byCategory)) {
            message += `**${category}** (${resources.length}):\n`;
            resources.forEach(r => {
                const date = new Date(r.created_at).toLocaleDateString();
                message += `‚Ä¢ ${r.name} - *Created ${date}*\n`;
            });
            message += '\n';
        }

        return {
            success: true,
            message: message.trim()
        };

    } catch (error: any) {
        console.error('Error listing resources:', error);
        return {
            success: false,
            message: `‚ùå Failed to list resources: ${error.message}`
        };
    }
}

